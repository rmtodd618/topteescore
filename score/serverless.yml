

service: score # NOTE: update this with your service name
#app: your-app-name
#tenant: your-tenant-name

# You can pin your service to only deploy with a specific Serverless version
# Check out our docs for more details
# frameworkVersion: "=X.X.X"

provider:
  name: aws
  runtime: nodejs10.x
  memorySize: 512
  iamRoleStatements:
  - Effect: Allow
    Action:
      - s3:*
    Resource: "*"
  - Effect: Allow
    Action:
      - lambda:InvokeFunction
    Resource: arn:aws:lambda:*:*:function:*
  - Effect: Allow
    Action:
      - dynamodb:*
    Resource: arn:aws:dynamodb:*:*
  region: us-east-1
resources:
  Description: "Stroke tracker for stage >> ${opt:stage}"
  Resources:
    StrokeRecorderBucket:
      Type: AWS::S3::Bucket
      Properties:
        BucketName: golf-strokes
    ScoreCard:
      Type: "AWS::DynamoDB::Table"
      Properties:
        AttributeDefinitions:
          - AttributeName: "name"
            AttributeType: "S"
          - AttributeName: "serialNumber"
            AttributeType: "S"
        KeySchema:
          - AttributeName: "name"
            KeyType: "HASH"
        ProvisionedThroughput:
           ReadCapacityUnits: 1
           WriteCapacityUnits: 1
        TableName: score_card
        StreamSpecification:
          StreamViewType: NEW_IMAGE
        GlobalSecondaryIndexes:
          - IndexName: "serialnumber-index"
            KeySchema:
              - AttributeName: "serialNumber"
                KeyType: "HASH"
            Projection:
              ProjectionType: KEYS_ONLY
            ProvisionedThroughput:
              ReadCapacityUnits: 1
              WriteCapacityUnits: 1
# you can overwrite defaults here



functions:
  Iot:
    handler: app/iot/iot.handler
    description: Handles the clicks fo the buttom
    timeout: 60
    events:
      - iot:
          sql: "SELECT * FROM '${file(.local-keys.yaml):AWS_IOT_BUTTON_TOPIC}'"
          enabled: true

